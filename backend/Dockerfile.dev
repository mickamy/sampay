ARG GO_VERSION=1.23.4

FROM --platform=$BUILDPLATFORM golang:${GO_VERSION}

ARG MAIN_GO_FILE
ENV MAIN_GO_FILE=$MAIN_GO_FILE
ARG BIN_NAME
ENV BIN_NAME=$BIN_NAME

ARG GOOGLE_CLIENT_ID
ARG GOOGLE_CLIENT_SECRET
ENV GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID
ENV GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET

WORKDIR /src

ADD . .

CMD ["air", "--build.cmd", "go build -o ./build/$BIN_NAME $MAIN_GO_FILE", "--build.bin", "./build/$BIN_NAME"]
